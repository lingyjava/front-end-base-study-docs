# 2·事件高级

<!-- TOC -->
* [2·事件高级](#2事件高级)
  * [注册事件](#注册事件)
    * [传统方式](#传统方式)
    * [方法监听方式](#方法监听方式)
  * [删除事件](#删除事件)
  * [DOM事件流](#dom事件流)
  * [事件对象](#事件对象)
  * [阻止事件冒泡](#阻止事件冒泡)
  * [事件委托](#事件委托)
  * [常用鼠标事件](#常用鼠标事件)
  * [常用键盘事件](#常用键盘事件)
<!-- TOC -->

## 注册事件
给元素添加事件，称为注册事件或绑定事件。  

注册事件有两种方式：传统方式、方法监听注册方式。

### 传统方式
- 使用on开头的事件属性。
- 注册的事件有唯一性。
- 同一个元素的同一个事件只能设置一个处理函数，最后注册的函数覆盖之前函数。
- `<div onclick = "alert('hi')"></div>`
- `div.onclick = function(){}`

### 方法监听方式
- w3c标准，推荐方式。
- addEventListener()方法。
- IE9前不支持，使用attachEvent()方法代替。
- 同一元素的同一个事件可以注册多个监听器，按注册顺序依次执行。

```js
var eventTarget = document.querySelector('.box');
eventTarget.addEventListener(type, listener, useCapture);
```
- addEventListener() 方法将指定的监听器注册到目标对象上。
- type：事件类型字符串，不带on，如 click、mouseover.
- listener：事件处理函数，事件发生时，调用该监听函数。
- useCapture：可选参数，布尔值，默认为false.

```js
var btn = document.querySelector('#btn');
btn.addEventListener('click', function () {console.log(listener1);});
btn.addEventListener('click', function () {console.log(listener2);});
```

---------------

attachEvent事件监听方式：
```js
var eventTarget = document.querySelector('.box');
eventTarget.attachEvent('onclick', function () {})
```

## 删除事件
传统注册方式：eventTarget.onclick = null;

方法监听注册方式：
- eventTarget.removeEventListener(type, listener, useCapture);
- eventTarget.detachEvent(eventNameWithOn, callback);

## DOM事件流
事件流描述的是从页面中接收事件的顺序。事件发生时在元素节点之间按照特性的顺序传播，传播过程就是DOM事件流。

DOM事件流的三个阶段：
1. 捕获阶段。
2. 当前目标阶段。
3. 冒泡阶段。

- 事件冒泡：IE最早提出，事件开始时由最具体的元素接收，然后逐级向上传播到DOM最顶层节点的过程。
- 事件捕获：网景最早提出，由DOM最顶层节点开始，然后逐级向下传播到最具体的元素接收的过程。

注意：
- JS代码中只能执行捕获或者冒泡其中的一个阶段。
- onclick 和 attachEvent 只能得到冒泡阶段。
- addEventListener() 的第三个参数：如果为true，表示事件捕获阶段调用事件处理程序；如果为false（默认值），表示在事件的冒泡阶段调用事件处理程序。
- 实际中很少使用 事件捕获，更多使用事件冒泡。
- 有些事件没有冒泡阶段，如onblur、onfocus、onmouseenter、onmouseleave.

## 事件对象
事件对象是事件发生后跟事件相关的一系列相关数据的集合，鼠标相关事件包含了鼠标相关信息等，键盘事件包含键盘信息等。  
event 就是一个事件对象，代表事件的状态，写在侦听函数的形参列表中，事件对象可以命名，如event、e、evt.  
event 对象存在兼容性问题，在ie9前使用 window.event 获取查找事件对象。

```js
var div = document.querySelector('div');
div.onclick = function (event) {
  console.log(event);
  console.log(window.event);
  
  // 解决兼容性问题
  var e = event || window.event;
  console.log(e);
}
```

事件对象中的常见属性和方法：

| 属性方法                | 说明                               |
|---------------------|----------------------------------|
| e.target            | 属性，返回触发事件的对象，标准                  |
| e.srcElement        | 属性，返回触发事件的对象，非标准 ie6-8使用         |
| e.type              | 属性，返回事件的类型，不带on，如click mouseover |
| e.cancelBubble      | 属性，该属性阻止冒泡，非标准 ie6-8使用           |
| e.returnValue       | 属性，该属性阻止默认事件，非标准 ie6-8使用，如不让链接跳转 |
| e.preventDefault()  | 方法，该方法阻止默认事件，标准，如不让链接跳转          |
| e.stopPropagation() | 方法，阻止冒泡，标准                       |

注意：
- this 表示的是绑定事件的元素。
- e.target 表示的是触发事件的元素，可能是父元素绑定了事件的，子元素触发，所以this 不等同于 e.target。

## 阻止事件冒泡
## 事件委托
## 常用鼠标事件
## 常用键盘事件

